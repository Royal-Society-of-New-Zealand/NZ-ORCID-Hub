version: '2'
services:
  db:
    image: postgres:9.6.2
    environment:
      - POSTGRES_PASSWORD
      - PGPASSWORD
    domainname: orcidhub.org.nz
    hostname: db
    volumes:
      - ./orcidhub-core/conf/init-user-db.sh:/docker-entrypoint-initdb.d/init-user-db.sh

  app:
    depends_on:
      - db
    image: orcidhub/app
    environment:
      - ENV
      - POSTGRES_PASSWORD
      - PGPASSWORD
      - ORCID_CLIENT_ID=APP-TF7LKIE084PYTQ59
      - ORCID_CLIENT_SECRET
    domainname: orcidhub.org.nz
    hostname: app
    volumes:
      - ./orcidhub-core:/var/www/orcidhub/
      - ./orcidhub-core/run-app:/usr/local/bin/run-app
      - ./orcidhub-core/app.conf:/etc/httpd/conf.d/ZZ-app.conf
      - ./orcidhub-core/conf/attribute-map.xml:/etc/shibboleth/attribute-map.xml
      - ./orcidhub-core/tuakiri-${ENV}-metadata-cert.pem:/etc/shibboleth/tuakiri-${ENV}-metadata-cert.pem
      - ./.keys/sp-key.pem:/etc/shibboleth/sp-key.pem
      - ./.keys/sp-cert.pem:/etc/shibboleth/sp-cert.pem

