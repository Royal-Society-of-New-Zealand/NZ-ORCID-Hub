{% extends "layout.html" %}
{% block content %}
  <div class="jumbotron">
    <p>
    <strong>Kia ora {{ user.name}}</strong>,</p>
    <div class="text-center">
    <div class="body-message">
        <p>You are logged into the New Zealand ORCID hub through <strong>{{ user.organisation.name }}</strong>.</p>

        <p>You have given these permissions to connect to your ORCID record.</p>
        <div class="table-responsive">
            <table class="table permissions">
              <thead>
                <tr class="info">
                  <th style="text-align: center;">your email</th>
                  <th style="text-align: center;">ORCID permissions</th>
                </tr>
              </thead>
              <tbody>
                {% for user_orcid_data in users_orcid or [] %}
                          <tr class="active">
                            <td> {% if user_orcid_data.user.email %}{{ user_orcid_data.user.email}} {% endif %} </td>
                            <td> {% if user_orcid_data.scope %}
                                    {% if user_orcid_data.scope == "/activities/update" %}
                                        {{user_orcid_data.scope + '\n(' + user_orcid_data.org|string() + ' can read and write information to your ORCID record)'}}
                                    {% elif user_orcid_data.scope == "/read-limited" %}
                                        {{user_orcid_data.scope + '\n(' + user_orcid_data.org|string() + ' can read information from your ORCID record)'}}
                                    {% elif user_orcid_data.scope == "/authenticate" %}
                                        {{user_orcid_data.scope + '\n(' + user_orcid_data.org|string() + ' knows your ORCID iD)'}}
                                    {% else %}
                                        {{user_orcid_data.scope}}
                                    {% endif %}
                                {% endif %} </td>
                          </tr>
                {% endfor %}
              </tbody>
            </table>
        </div>
        {% if session['Should_not_logout_from_ORCID'] %}
        <p class="text-center">To manage your ORCID permissions, log into the settings page of your ORCID record here:<a href= '{{ profile_url + "account"}}' ><span>{{ profile_url + 'account' }}</span></a> and review the "Trusted organisations" listed.</p>
        <button class="connect-orcid-button" onclick="location.href='{{profile_url + 'signin'}}'" style="height: 50px;width: auto;">
            <img class="orcid-id-logo" src="https://orcid.org/sites/default/files/images/orcid_24x24.png" width="24" height="24" alt="ORCID logo" /> Manage ORCID Record
        </button>
        {% else %}
        <p class="text-center">To manage your ORCID permissions, log into the settings page of your ORCID record here:<a onclick=logoutOrcidAccount()><span>{{ profile_url + 'account' }}</span></a> and review the "Trusted organisations" listed.</p>
        <button class="connect-orcid-button" onclick="logoutOrcid()" style="height: 50px;width: auto;">
            <img class="orcid-id-logo" src="https://orcid.org/sites/default/files/images/orcid_24x24.png" width="24" height="24" alt="ORCID logo" /> Manage my ORCID Record
        </button>
        {% endif %}
        <button class="connect-orcidhub-google-group-button" onclick="location.href='https://groups.google.com/a/aucklanduni.ac.nz/forum/#!forum/nz-orcid-hub-gg'" style="height: 50px;width: auto;">
            <img class="orcidHub-id-logo" src="{{url_for('static', filename='images/logo.png')}}" width="24" height="24" alt="ORCIDHUB logo" /> Help &amp; Support
        </button>
    </div>
</div>
      <script>
        function logoutOrcid() {
            $.ajax({
                url: "{{profile_url}}" + "userStatus.json?logUserOut=true",
                dataType: 'jsonp',
                success: function(result,status,xhr) {
                    window.location='{{profile_url + "signin"}}'
                },
                error: function (xhr, status, error) {
                    alert(status);
                }
            });}
        function logoutOrcidAccount() {
            $.ajax({
                url: "{{profile_url}}" + "userStatus.json?logUserOut=true",
                dataType: 'jsonp',
                success: function(result,status,xhr) {
                    window.location='{{ profile_url + "account"}}'
                },
                error: function (xhr, status, error) {
                    alert(status);
                }
            });}
    </script>
  </div>
{% endblock %}
