{% extends "layout.html" %}
{% from "macros.html" import render_field, form_tag %}

{% block content %}
  <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/angularjs/1.3.9/angular.min.js"></script>
    <script type="text/javascript">
        var app = angular.module('MyApp', [])
        app.config(['$interpolateProvider', function($interpolateProvider) {
        $interpolateProvider.startSymbol('{a');
        $interpolateProvider.endSymbol('a}'); }]);

        app.controller('MyController', function ($scope, $window) {
            $scope.externalids = {{grant_data_list | safe}};
            $scope.grant_number = ''
            $scope.url = ''
            $scope.relationship = ''
            $scope.grant_type = ''

            $scope.Add = function () {
                //Add the new item to the Array.
                var externalid = {};
                externalid.grant_number = $scope.grant_number;
                externalid.grant_type = $scope.grant_type;
                externalid.grant_url = $scope.grant_url;
                externalid.grant_relationship = $scope.grant_relationship;
                $scope.externalids.push(externalid);
            };

            $scope.Remove = function (index) {
                //Find the record using Index from Array.
                if ($window.confirm("Do you want to delete")) {
                    //Remove the item from Array using Index.
                    $scope.externalids.splice(index, 1);
                }
            }
        });
    </script>
  {% call form_tag(form) %}
<div class="row">
  <div class="col-md-9 col-sm-8 col-xs-12">
    <h1>{{tile or ("Education" if section_type == "EDU" else "Funding" if section_type == "FUN" else "Peer Review" if
      section_type == "PRR" else "Employment")}}</h1>
  </div>
</div>
    <div class="row" ng-app="MyApp" ng-controller="MyController">
      <div class="col-md-6 col-sm-6 col-xs-12">
        {% if section_type == "WOR" %}
          {{ render_field(form.work_type) }}
          {{ render_field(form.title) }}
          {{ render_field(form.subtitle) }}
          {{ render_field(form.translated_title) }}
          {{ render_field(form.translated_title_language_code) }}
        {% else %}
          {{ render_field(form.org_name) }}
          {{ render_field(form.city) }}
          {{ render_field(form.state) }}
          {{ render_field(form.disambiguated_id) }}
        {% endif %}
        {{ render_field(form.country) }}
        {% if section_type == "FUN" or section_type == "PRR" or section_type == "WOR"%}
        <input type="button" class="btn btn-danger" ng-click="Add()"
               value="External Identifier Info (Atleast add one info)"/><br>
        <div ng-repeat="m in externalids">
          <strong>{{"External ID Type" if section_type != "FUN" else "Funding Grant Type"}}</strong><br>
          <input type="text" class="form-control" name="grant_type" value="{a m.grant_type a}"/><br>
          <strong>{{"External ID" if section_type != "FUN" else "Funding Grant Number"}}</strong><br>
          <input type="text" class="form-control" name="grant_number" value="{a m.grant_number a}"/><br>
          <strong>{{"External ID Url" if section_type != "FUN" else "Funding Grant Url"}}</strong><br>
          <input type="text" class="form-control" name="grant_url" value="{a m.grant_url a}"/><br>
          <strong>{{"External ID Relationship" if section_type != "FUN" else "Funding Grant Relationship"}}</strong><br>
          <input type="text" class="form-control" name="grant_relationship" value="{a m.grant_relationship a}"/><br>
          <input type="button" class="btn btn-danger" ng-click="Remove($index)" value="Remove"/><br>
        </div>
        {% endif %}
      </div>
      <div class="col-md-6 col-sm-6 col-xs-12">
        {% if section_type == "WOR" %}
          {{ render_field(form.journal_title) }}
          {{ render_field(form.short_description) }}
          {{ render_field(form.citation_type) }}
          {{ render_field(form.citation) }}
          {{ render_field(form.publication_date) }}
          {{ render_field(form.url) }}
          {{ render_field(form.language_code) }}
        {% elif section_type == "PRR" %}
          {{ render_field(form.reviewer_role) }}
          {{ render_field(form.review_url) }}
          {{ render_field(form.review_type) }}
          {{ render_field(form.review_group_id) }}
          {{ render_field(form.subject_external_identifier_type) }}
          {{ render_field(form.subject_external_identifier_value) }}
          {{ render_field(form.subject_external_identifier_url) }}
          {{ render_field(form.subject_external_identifier_relationship) }}
          {{ render_field(form.subject_container_name) }}
          {{ render_field(form.subject_type) }}
          {{ render_field(form.subject_title) }}
          {{ render_field(form.subject_subtitle) }}
          {{ render_field(form.subject_translated_title) }}
          {{ render_field(form.subject_translated_title_language_code) }}
          {{ render_field(form.subject_url) }}
          {{ render_field(form.review_completion_date) }}
          {{ render_field(form.disambiguation_source) }}
        {% else %}
          {% if section_type == "FUN" %}
            {{ render_field(form.funding_title) }}
            {{ render_field(form.funding_translated_title) }}
            {{ render_field(form.translated_title_language) }}
            {{ render_field(form.funding_type) }}
            {{ render_field(form.funding_subtype) }}
            {{ render_field(form.funding_description) }}
            {{ render_field(form.total_funding_amount) }}
            {{ render_field(form.total_funding_amount_currency) }}
          {% else %}
            {{ render_field(form.department) }}
            {{ render_field(form.role) }}
          {% endif %}
          {{ render_field(form.start_date) }}
          {{ render_field(form.end_date) }}
          {{ render_field(form.disambiguation_source) }}
        {% endif %}
        <button type="submit" class="btn btn-primary" value="Save">Save</button>
        <a role="button" class="btn btn-default" href="{{_url}}">Cancel</a>
      </div>
    </div>
  {% endcall %}
{% endblock %}
