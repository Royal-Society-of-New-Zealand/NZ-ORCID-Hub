FROM orcidhub/app

LABEL maintainer="The University of Auckland" \
	version="2.1" \
	description="NZ ORCiD Hub Application Image with Development support"

COPY dev_requirements.txt /dev_requirements.txt

RUN yum -y update \
    && yum -y install  install https://download.postgresql.org/pub/repos/yum/9.6/redhat/rhel-7-x86_64/pgdg-redhat96-9.6-3.noarch.rpm \
    && yum -y install \
            postgresql96 \
	    python36u-pip \
	    git \
    && pip3.6 install -U git+https://github.com/Royal-Society-of-New-Zealand/zap-cli \
    && pip3.6 install -U flake8_docstrings pytest-cov coveralls pyyaml \
    && pip3.6 install -U -r /dev_requirements.txt \
    && cd /var/lib/rpm \
    && rm -rf __db* \
    && rpm --rebuilddb \
    && yum -y clean all \
    && rm -rf /var/cache/yum \
    && rm -rf $HOME/.pip/cache \
    && rm -rf /var/cache/*/* /anaconda-post.log /dev_requirements.txt \
    && find / -name __pycache__ -exec rm -rf "{}" \;


ENV DEBUG=1
WORKDIR /src
